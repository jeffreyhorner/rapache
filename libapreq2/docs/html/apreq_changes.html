<html>
<head>
  <link rel="stylesheet" type="text/css" href="dox.css" />
  <title>libapreq2-2.05-dev: libapreq2: CHANGES</title> 
</head>
<body>
<div id="page-header">
<p class="menu">
   <a href="http://www.apache.org/">Apache Software Foundation</a> &gt; <a href="http://httpd.apache.org">HTTP Server Project</a> &gt;
<a href="http://httpd.apache.org/apreq/">Request Library Subproject</a></p>
<p class="apache">Apache HTTP Server Request Library</p>
<img alt="" src="feather.gif" /></div>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<b>CHANGES</b></div>
<h1><a class="anchor" name="apreq_changes">CHANGES</a></h1><h2><a class="anchor" name="v2_05_dev">
Changes with libapreq2-2.05-dev (released May 5, 2005)</a></h2>
<ul>
<li>Win32 build [Randy Kobes] Have top-level 'nmake', 'nmake test', and 'nmake install' targets, respectively, also include building, testing, and installing the corresponding perl glue targets.</li></ul>
<p>
<ul>
<li>C API [geoff] Minimum httpd version is now 2.0.48, which includes the official apr 0.9.4 release.</li></ul>
<p>
<ul>
<li>C API [Max Kellermann] Fix apreq_quote.</li></ul>
<p>
<ul>
<li>Perl API [joes] Remove Apache2::Request::args. WARNING: through inheritance, args() now maps to Apache2::RequestRec::args. Folks that want the pre-2.05-dev behavior need to invoke APR::Request::args by name.</li></ul>
<p>
<ul>
<li>C API [joes, Max Kellermann] Add apreq_initialize, apreq_pre_initialize and apreq_post_initialize. These are not thread-safe operations, so applications need to ensure they are invoked (in the correct sequence) prior to using any apreq2 modules.</li></ul>
<p>
<ul>
<li>C, Perl API [joes] Add pool, bucket_alloc to <a class="el" href="structapreq__handle__t.html">apreq_handle_t</a>.</li></ul>
<p>
<ul>
<li>Perl API [joes] Drop $data argument from UPLOAD_HOOK, and also drop HOOK_DATA option. Perl folks should use a closure instead of passing in context data.</li></ul>
<p>
<ul>
<li>Perl API [joes] Move bake, bake2 to Apache2::Cookie, now requiring an extra $r argument. Also ""-operator is mapped to as_string() for Apache2::Cookie; but APR::Request::Cookie maps it to value().</li></ul>
<p>
<ul>
<li>C API [joes] Remove header_in &amp; header_out from <a class="el" href="structapreq__module__t.html">apreq_module_t</a>. Remove <a class="el" href="apreq__module_8h.html#a24">apreq_ua_cookie_version()</a> and apreq_cookie_bake*(). Remove cookie2 argument to <a class="el" href="apreq__module_8h.html#a21">apreq_handle_custom()</a>.</li></ul>
<p>
<ul>
<li>C API [joes] s/APREQ/APREQ2/g in webserver configuration directives.</li></ul>
<p>
<ul>
<li>C API [Igor Shevchenko, Philip Gollucci] Fix segfault in mfd parser caused by parts w/ empty param names.</li></ul>
<p>
<ul>
<li>C API [joes] Add <a class="el" href="apreq__util_8h.html#a5">apreq_cp1252_to_utf8()</a>.</li></ul>
<p>
<ul>
<li>C, Perl API [joes] Add charset support for params and couple the SvUTF8 flag to the param's taint flag.</li></ul>
<p>
<ul>
<li>C API [joes] Replace v-&gt;size with v-&gt;nlen + v-&gt;dlen. Added supporting apreq_value_table_add().</li></ul>
<p>
<ul>
<li>C API [joes] Remove apreq_cookie_attr().</li></ul>
<p>
<ul>
<li>C API [joes]<ul>
<li>Add <a class="el" href="apreq__error_8h.html">apreq_error.h</a>, <a class="el" href="apreq__module_8h.html">apreq_module.h</a>.</li><li>Rename apreq_run* and apreq_make* funcs to conform with apreq_$obj_$meth scheme.</li><li>Replace c-&gt;version &amp; c-&gt;secure with flags.</li><li>Parsers are assumed to be working with external data, so the cookies &amp; params they produce are marked tainted.</li></ul>
</li></ul>
<p>
<ul>
<li>C API [joes] <a class="el" href="apreq__cookie_8h.html#a11">apreq_parse_cookie_header()</a> failed to parse RFC Cookie headers which contained no space chars after the '$Version=1' preamble.</li></ul>
<p>
<ul>
<li>C API [joes] Reorganize around include/, library/, and module/ dirs.</li></ul>
<p>
<ul>
<li>C Tests [joes] Replace CuTest-based tests with custom TAP-compliant framework.</li></ul>
<p>
<ul>
<li>C API [Max Kellermann] Continue the API improvements:</li></ul>
<p>
<ul>
<li>Convert APREQ_RUN_PARSER and APREQ_RUN_HOOK to inline, and downcase them.</li><li>Remove apreq_memmem.</li><li>Convert apreq_(un)escape to inline.</li><li>apreq_escape does not create an apreq_value_t*.</li><li>Initialize default_parsers explicitly to NULL.</li><li>Convert APREQ_BRIGADE_COPY to inline, and downcase it.</li><li>Lowercase APREQ_BRIGADE_SETASIDE, APREQ_BRIGADE_COPY.</li><li>Convert apreq_cookie_name and apreq_cookie_value macros to inline.</li><li>Convert apreq_param_name, apreq_param_value, apreq_param_info, and apreq_param_brigade to inline.</li></ul>
<p>
<ul>
<li>C API [joes] Widespread API refactorization to remove apreq_jar_t and apreq_request_t:</li></ul>
<p>
<ul>
<li>Header includes reorganized; apreq_parsers.h added (back again).</li><li>Replaced apreq_jar_t and apreq_request_t with single apreq_env_handle_t.</li><li>Added const qualifier to "v" attribute of <a class="el" href="structapreq__cookie__t.html">apreq_cookie_t</a> and <a class="el" href="structapreq__param__t.html">apreq_param_t</a>.</li><li>Use union type-puns to drop const qualifiers inside the new apreq_value_to_cookie and apreq_value_to_param implementations (gcc generates same object code as the macro versions did).</li><li>Moved "flags" attribute from <a class="el" href="structapreq__value__t.html">apreq_value_t</a> to <a class="el" href="structapreq__cookie__t.html">apreq_cookie_t</a> and <a class="el" href="structapreq__param__t.html">apreq_param_t</a>.</li><li>Remove env argument from hooks and parsers.</li><li>Reduce apreq_env_module to minimal set of operations.</li><li>Replace apreq_log calls with apreq-specific error codes.</li><li>Hooks are called on each body param now, not just during file uploads.</li><li>Tie the cgi handle to its creator pool.</li></ul>
<p>
Detailed changes by header file:<p>
[<a class="el" href="apreq_8h.html">apreq.h</a>]<ul>
<li>Remove flags from <a class="el" href="structapreq__value__t.html">apreq_value_t</a>.</li><li>Remove const qualifier from apreq_value_t's "name" attribute.</li><li>Remove apreq_value_merge* and apreq_value_copy*.</li><li>Remove apreq_char_to_value, apreq_strtoval, and apreq_strlen.</li><li>Move apreq_enctype to apreq_env.h.</li><li>Move apreq_env_handle_t struct definition to apreq_env.h</li><li>Change signature of apreq_decode.</li><li>Move apreq_brigade_concat here, changed its signature and improved it alot.</li><li>Remove apreq_brigade_spoolfile.</li><li>Dropped APREQ_*_ENCTYPE, renamed some APREQ_$foo defaults APREQ_DEFAULT_$foo.</li><li>Added APREQ_ERROR_*.</li></ul>
<p>
[<a class="el" href="apreq__cookie_8h.html">apreq_cookie.h</a>]<ul>
<li>Remove apreq_env.h include.</li><li>Remove apreq_jar_t.</li><li>Add "flags" to <a class="el" href="structapreq__cookie__t.html">apreq_cookie_t</a>, add const qualifier to its "v" attr.</li><li>Remove apreq_jar* functions.</li><li>Add apreq_parse_cookie_header.</li><li>Move apreq_cookie, apreq_cookie_bake(2), and apreq_ua_cookie_version to apreq_env.h.</li></ul>
<p>
[apreq_params.h]<ul>
<li>Remove apreq_env.h include.</li><li>Remove apreq_request_t.</li><li>Add "flags" to <a class="el" href="structapreq__param__t.html">apreq_param_t</a>, and const qualifier to its "v" attr.</li><li>Rename "bb" attribute "upload" in <a class="el" href="structapreq__param__t.html">apreq_param_t</a>.</li><li>Remove apreq_request* functions.</li><li>Remove apreq_parse_request.</li><li>Changed apreq_decode_param signature.</li><li>Replace env argument with apr_table_t in apreq_params_as_array, apreq_params_as_string,</li><li>Move remaining apreq_param* to apreq_env.h.</li><li>Move parser and hook sections to apreq_parsers.h.</li><li>Change apreq_upload(s) old apreq_request_t arg to apr_table_t.</li></ul>
<p>
[apreq_parsers.h]<ul>
<li>Acquire the hook and parser sections of original apreq_params.h.</li><li>Remove env argument from APREQ_PARSER_ARGS and APREQ_HOOK_ARGS</li><li>Augment <a class="el" href="structapreq__hook__t.html">apreq_hook_t</a> and <a class="el" href="structapreq__parser__t.html">apreq_parser_t</a> to replace missing env features.</li><li>Change apreq_make_parser and apreq_make_hook signatures.</li><li>Rename apreq_add_hook to apreq_parser_add_hook, returning apr_status_t.</li><li>Change apreq_parser signature.</li></ul>
<p>
[apreq_env.h]<ul>
<li>Remove read, log, pool, bucket_alloc, request, jar, and query_string methods.</li><li>Include apreq_parsers.h.</li><li>Reorganize apreq_env_module_t to provide hook, parser, jar, args, &amp; body table ops.</li><li>Rename max_brigade to "brigade_limit", max_body to "read_limit".</li><li>Change related module sigs, including temp_dir, to get/set methods.</li><li>Add parser and read_limit args to apreq_env_make_custom_handle.</li><li>Drop "name" arg and APREQ_ENV_MODULE =~ s/_ENV//.</li><li>s/apreq_env_make/apreq_handle/ in the handle constructor names.</li></ul>
<p>
[mod_apreq.c, apreq_env_apache2.h]<ul>
<li>Changed APREQ_Max* configs to APREQ_BrigadeLimit and APREQ_ReadLimit.</li><li>Handle constructor renamed apreq_handle_apache2.</li></ul>
<p>
<ul>
<li>C API [joes] Make our "libtool current interface" number depend on apr's major number. This allows libapreq2 to be installed into a system-wide location while avoiding ABI conflicts arising from our apr-based interfaces.</li></ul>
<p>
<ul>
<li>C API [Max Kellermann] Introduce apreq_env_handle_t to replace the void *env usage. Also added apreq_env_custom for making private handles, and new apreq_env_apache2.h to let mod_apreq export apreq_env_make_apache2.</li></ul>
<p>
<ul>
<li>C API [Max Kellermann] Rename apreq_env_t to apreq_env_module_t, to prepare for a new thread-safe apreq_env API.</li></ul>
<p>
<ul>
<li>C API [Max Kellermann] mod_apreq must check the return value of apreq_brigade_concat to avoid a RAM-consuming infinite loop. A bad APREQ_TempDir setting can cause this situation.</li></ul>
<p>
<ul>
<li>C API [joes] Provide workaround for chunked trailers bug in ap_http_filter.</li></ul>
<p>
<ul>
<li>C, Perl API [joes] Several upload-related bugfixes: 1) apreq_upload and apreq_uploads did not search the full body table, 2) $upload-&gt;slurp and $io-&gt;read did not autovivify the resultant string.</li></ul>
<p>
<ul>
<li>C API [joes] Add "flags" attribute to <a class="el" href="structapreq__value__t.html">apreq_value_t</a>, planning for charset support. This is an ABI change, starting with libapreq2.so.2.0.24.</li></ul>
<p>
<ul>
<li>C API [joes] Add apreq_env_bucket_alloc() to get an allocator directly from the environment instead of creating them from a pool. This is an ABI change, starting with libapreq2.so.2.0.23.</li></ul>
<p>
<ul>
<li>Build system [joes] Add --with-apache2-httpd option so users can override apxs's notion of where the httpd executable is. XSBuilder's header parser runs from buildconf now instead of configure, so we will include those tables in the release tarball. buildconf gets an additional --with-perl option for running the xsbuilder.pl parsing script. The XS generation code in xsbuilder.pl has moved to glue/perl/Makefile.PL.</li></ul>
<p>
<ul>
<li>Perl API [joes] Allow ctors for Apache::Cookie, Apache::Cookie::Jar and <a class="elRef" doxygen="apu.tag:http://apr.apache.org/docs/apr-util/" href="http://apr.apache.org/docs/apr-util/namespace_apache.html">Apache</a>:::Request to accept Apache::Request objects (instead of requiring an Apache::RequestRec object). This thread details the bug <a href="http://thread.gmane.org/gmane.comp.apache.mod-perl/15727">http://thread.gmane.org/gmane.comp.apache.mod-perl/15727</a></li></ul>
<p>
<ul>
<li>C API [Bojan Smojver] Bake cookies with err_headers_out so they are sent on non-2xx server responses (ie. a 304 redirect). Also ensure that headers are copied with apr_table_add instead of apr_table_addn. Since <a class="el" href="apreq__module_8h.html#a22">apreq_cookie_bake()</a> allocates from the stack, the Set-Cookie headers would occasionally get mangled without this patch.</li></ul>
<p>
<ul>
<li>C API [joes] Add <a class="el" href="apreq__parser_8h.html#a19">apreq_register_parser()</a>, which allows users to add their own parsers to <a class="el" href="apreq__parser_8h.html#a18">apreq_parser()</a>'s recognized MIME types.</li></ul>
<p>
<ul>
<li>C API [joes] Support "multipart/mixed" file uploads. Support XForms' "multipart/related" enctype.</li></ul>
<p>
<ul>
<li>C API [joes] Add apreq_hook_apr_xml_parser(), which is a simple wrapper hook around APR's expat-based apr_xml_parser. Add a generic parser apreq_parse_generic() to parse arbitrary enctypes using the hook API.</li></ul>
<h2><a class="anchor" name="v2_04_dev">
Changes with libapreq2-2.04-dev (released August 30, 2004)</a></h2>
<ul>
<li>Perl API [joes] Add TAINT checks, marking all parsed data as tainted.</li></ul>
<p>
<ul>
<li>C API [joes] Add body_status attribute to apreq_request_t, to allow the both environment and the parser to report any errors encountered.</li></ul>
<p>
<ul>
<li>C API [randyk, joes] Cookie parser was locking up on non-alphanumeric chars in cookie names. Also RFC Cookie attributes are always checked for quotes during bake(2), and the quotes are now stripped from incoming RFC cookies during parsing (but they are never stripped from the actual cookie value).</li></ul>
<p>
<ul>
<li>Perl API [joes] Apache::Cookie::Jar-&gt;new accepts a VALUE_CLASS argument, which effectively blesses all the jar's cookies into that class, which simplifies subclassing Apache::Cookie. Accordingly Apache::Cookie-&gt;freeze($value) no longer accepts a freeze()-able object in $value.</li></ul>
<p>
<ul>
<li>C API [Markus Wichitill, randyk, joes] Drop APR_DELONCLOSE from apreq_file_mktemp implementation and install apreq_file_cleanup. When passed to apr_file_open on Win32, APR_DELONCLOSE sets the FILE_SHARED_DELETE flag, which is, unfortunately, a property that is preserved across NTFS "hard" links. This breaks apps that link() the temp file to a permanent location, and subsequently expect to open it without FILE_SHARED_DELETE before the original tempfile is closed+deleted. In fact, even Apache::Upload does this, so it is a common enough event that the apreq_file_cleanup workaround is necessary.</li></ul>
<p>
<ul>
<li>C API [Ken Burcham, joes] Fix bug in url parser that occurs when a XX-encoded sequence is split across multiple buckets. Added apreq_decode_decodev to make this problem less inconvenient.</li></ul>
<p>
<ul>
<li>Perl API [joes] Exception objects inherit from the object which raised it, which allows $@ to invoke its methods with impunity (exceptions are disabled for objects which derive from an exception class).</li></ul>
<p>
<ul>
<li>Perl API [joes] Implement HOOK_DATA and UPLOAD_HOOK.</li></ul>
<p>
<ul>
<li>Perl API [joes] Add safe XS wrappers for $table-&gt;add, $table-&gt;set, $table-&gt;STORE, and $table_class-&gt;new.</li></ul>
<p>
<ul>
<li>Perl API [joes] Add exceptions to $upload-&gt;link, $upload-&gt;tempname, $upload-&gt;slurp, and $cookie-&gt;set_attr. Return value of $upload-&gt;slurp is now the upload length. Also document new $upload-&gt;io.</li></ul>
<p>
<ul>
<li>C API [joes] Restrict all apr_status_t codes to APR_SUCCESS, APR_INCOMPLETE, APR_EGENERAL, APR_EINIT, APR_ENOTIMPL, since any others will generate confusing error messages from apr_strerror.</li></ul>
<p>
<ul>
<li>Perl API [joes] Added $upload-&gt;io with a TIEHANDLE API layered over APR::Brigade. $upload-&gt;fh remains implemented as an APR::PerlIO object, which is seekable but less efficient and currently suffers some portability issues associated with largefile support in perl and apr.</li></ul>
<p>
<ul>
<li>Perl API [joes] Added apreq_xs_croak for throwing APR::Error exceptions and included error-checking on $req-&gt;param, $req-&gt;args, $req-&gt;body, $req-&gt;upload, and $jar-&gt;get.</li></ul>
<p>
<ul>
<li>Perl API [joes] Added $jar-&gt;status, $req-&gt;args_status and $req-&gt;body_status to report parsing errors. Also add $upload-&gt;tempname per user request.</li></ul>
<p>
<ul>
<li>C API [joes] Dropped status attribute of <a class="el" href="structapreq__value__t.html">apreq_value_t</a>. Added status field to apreq_jar_t and added args_status field to apreq_request_t. Parsers also must return their public status code when a NULL brigade is passed. apreq_hook_disable_uploads() is also added. This is an ABI change affecting all versions of libapreq2 prior to 2.0.12.</li></ul>
<p>
<ul>
<li>Perl API [joes] $upload-&gt;info returns a proper APR::Table object now. Also implemented $upload-&gt;size, $upload-&gt;fh, and $upload-&gt;type.</li></ul>
<p>
<ul>
<li>C API [Jean-François Meesse] mfd parser fails to parse CRLF-terminated files when the terminating boundary string is at the start of a new bucket. This is reportedly a common event for PDF files uploaded with Netscape 7.</li></ul>
<p>
<ul>
<li>Perl API [joes] Add back-compat support for Apache::Cookie-&gt;fetch() via Apache-&gt;request.</li></ul>
<p>
<ul>
<li>C API [joes] Add MaxBody, MaxBrigade, and TempDir per-dir directives to mod_apreq filter.</li></ul>
<p>
<ul>
<li>C API [joes] Replace free/tempnam dependency in <a class="el" href="apreq__util_8h.html#a13">apreq_file_mktemp()</a> with <a class="elRef" doxygen="apr.tag:http://apr.apache.org/docs/apr/" href="http://apr.apache.org/docs/apr/group__apr__file__io.html#gga52">apr_temp_dir_get()</a>. Add additional gcc warning flags when --enable-maintainer-mode is set.</li></ul>
<p>
<ul>
<li>C API [joes, Scott Hutton] Replace apreq_brigade_copy with more effective APREQ_BRIGADE_COPY macro. Also introduce APREQ_BRIGADE_SETASIDE to deal with buckets that need to be set aside for use in future function calls. mod_ssl generates transient buckets which tickled this bug.</li></ul>
<p>
<ul>
<li>Perl API [joes] Separate Apache::Upload module from Apache::Request for better organization.</li></ul>
<h2><a class="anchor" name="v2_03_dev">
Changes with libapreq2-2.03-dev (released June 12, 2004)</a></h2>
<ul>
<li>C API [joes] "Objectify" cookie/jar API: s/apreq_(make|serialize)_cookie/apreq_cookie_$1/ and reordering args so the cookie/jar object is always the first argument. Macros added to provide source-compatibility with the old names.</li></ul>
<p>
<ul>
<li>Perl API [joes] Added $upload-&gt;slurp($data), which reads the contents of the file upload "$upload" into the scalar "$data".</li></ul>
<p>
<ul>
<li>C API [joes, randyk] apreq_run_(hook|parser) are macros, so they are capitalized now. Fixed <a class="el" href="apreq__param_8h.html#a12">apreq_params_as_string()</a> and added <a class="el" href="apreq__param_8h.html#a11">apreq_params_as_array()</a>. Reworked definitions of APREQ_DECLARE_HOOK, APREQ_DECLARE_PARSER and apreq_(parser|hook)_t, hopefully to be more Win32 friendly. Also updated the documentation.</li></ul>
<p>
<ul>
<li>C API [joes] Compensate for a missing CRLF in empty file upload block, which actually complies with RFC 2046 Section 5.1.1. Konqueror (version unknown) and Mozilla 0.9.7 are known to emit such blocks.</li></ul>
<p>
<ul>
<li>Perl API [joes] $req-&gt;upload() in list context failed to filter out non-uploads. Also $req-&gt;upload("nonexistent-key-name") segfaults.</li></ul>
<p>
<ul>
<li>Perl test suite t/TEST.PL must run parent class' pre_configure to get the configuration right</li></ul>
<p>
<ul>
<li>C API [joes] <a class="el" href="apreq__util_8h.html#a18">apreq_brigade_concat()</a> wasn't supplying the final EOS bucket to large brigades (&gt;256K), which somtimes caused the prefetch loop in mod_apreq.c's apreq_filter() to hang.</li></ul>
<p>
<ul>
<li>Documentation [joes] CHANGES file reformatted, removing dates &amp; other clutter as Stas suggests.</li></ul>
<p>
<ul>
<li>C API [joes] Rewrote cgi_read() in apreq_env.c and reworked mod_apreq.c to enforce apreq_env_max_body() settings.</li></ul>
<p>
<ul>
<li>C API [joes] Fixed bug in url_parser code- missing context brigade was needed to track key-value pairs which span multiple buckets.</li></ul>
<p>
<ul>
<li>C API [joes] API modifications: removed struct apreq_cfg_t, adding new apreq_env hooks max_body, max_brigade_len, and temp_dir. Folded apreq_parsers.h into apreq_params.h and modified the arguments to apreq_run_parser() and apreq_run_hook(). Renamed apreq_parser_t's content_type as enctype and apreq_copy_brigade() as <a class="el" href="apreq__util_8h.html#a15">apreq_brigade_copy()</a>. These changes make libapreq2.so.2.0.5 incompatible with earlier versions.</li></ul>
<p>
<ul>
<li>Perl API [stas] Include ppport.h from blead-perl to support older perls. Add a proper support for ithreads.</li></ul>
<p>
<ul>
<li>C API [Swen Schillig, joes] Fixed bug in calculation of Netscape cookie expiration dates. apr_time_t is measured in microseconds, not seconds, which threw off the arithmetic; apr_time_from_sec was needed for the conversion.</li></ul>
<p>
<ul>
<li>C API [Max Kellermann] Fix segfault caused by invalid -escape sequence in query string.</li></ul>
<h2><a class="anchor" name="v2_02_dev">
Changes with libapreq2-2.02-dev (released Nov 15, 2003)</a></h2>
<ul>
<li>Perl API [joes] Fix bogus pool/cookie initializers in Apache::Cookie::set_attr(), which caused Apache::Cookie::new to segfault. Bug first reported to modperl list by Wolfgang Kubens.</li></ul>
<h2><a class="anchor" name="v2_01_dev">
Changes with libapreq2-2.01-dev (released Nov 10, 2003)</a></h2>
<ul>
<li>build system [joes] Skip Apache::Test tests in env/ when Apache::Test is unavailable. This allows the C API to be build and installed without requiring Apache::Test (it is still a requirement for compiling the perl glue).</li></ul>
<p>
<ul>
<li>C API mod_apreq.c [joes] Parser errors were creeping into the return value of apreq_filter, which breaks the "transparent tee" paradigm. This caused bogus "400 Bad Request" responses (first reported by Vladimir Dudo) to occur when libapreq2 was used by an output filter during a GET request (handled by apache2's default handler). The test suite has been updated accordingly.</li></ul>
<p>
<ul>
<li>C API [joes] Incorporate libapreq_cgi into libapreq2 as the default environment, and add apreq_env_t and initializer apreq_env_module() to manage the environment at runtime (determining the environment at load-time was problematic on non-ELF systems).</li></ul>
<h2><a class="anchor" name="v2_0_0">
Changes with libapreq2-2.00-dev (Oct 25, 2003)</a></h2>
<ul>
<li>C API: libapreq_cgi.c [randyk, joes] CGI environment defined by env/libapreq_cgi.c is functional (with tests added to env/t). This library may soon be incorporated directly into libapreq2 as a default enviroment.</li></ul>
<p>
<ul>
<li>C API: mod_apreq.c [joes] Added ctx-&gt;saw_eos to ensure we don't read from upstream filters after receiving an eos bucket. Otherwise it was possible for two eos buckets to appear when a prefetch read is involved, which breaks other modules like mod_proxy. This bug was uncovered by Philippe Chiasson. mod_apreq's apreq_env_majic_number bumped to reflect the added fixes.</li></ul>
<p>
<ul>
<li>configure: --enable-perl-glue [joes] The --enable-perl-glue option integrates the perl glue into the normal Unix build cycle. It is disabled by default, but is silently reenabled if the user configures the source tree via Makefile.PL.</li></ul>
<p>
<ul>
<li>C API [joes] Added <a class="el" href="apreq__util_8h.html#a17">apreq_header_attribute()</a> and fixed mfd parser to allow "charset" attribute to appear in the Content-Type header. Sven Geisler points out that Opera 7.20 does generate such headers.</li></ul>
<p>
<ul>
<li>C API [joes] Added versioning API following <a href="http://apr.apache.org/versioning.html">http://apr.apache.org/versioning.html</a> apreq_env renamed apreq_env_name, and apreq_env_magic_number added to provide versioning for environments (modules). The header files are now installed to "include/apreq2", and the library is renamed "libapreq2". Also added an apreq2-config script based on apu-config.</li></ul>
<p>
<ul>
<li>configure: static mod_apreq.c [Bojan Smojver, joes] Add --with-apache2-src configure option, along with --with-apr-config and --with-apu-config, and provide support for compiling mod_apreq into httpd as a static apache module.</li></ul>
<p>
<ul>
<li>C API: mod_apreq.c [joes] Support for internal redirects added to the mod_apreq filter. This ensures any POST data prefetched in the main request gets passed along to the subrequest handler(s).</li></ul>
<p>
<ul>
<li>C bugfix: apreq_decode [Graham Clark] If the source and destination strings are represented by the same pointer - e.g. if called as apreq_unescape(s) - string s is modified incorrectly in general. Patch includes new unit test.</li></ul>
<p>
<ul>
<li>Perl API [joes] Added $req-&gt;parse, $req-&gt;status, &amp; "preparse" logic to $req-&gt;param &amp; $req-&gt;upload.</li></ul>
<p>
<ul>
<li>C API [joes] Added "preparse" logic to apreq_params &amp; apreq_uploads to bring behavior in line with libapreq-1.x.</li></ul>
<p>
<ul>
<li>C API [joes] Dropped param-&gt;charset. Make apreq_brigade_concat public, so mod_apreq can use it for its ctx-&gt;spool brigade.</li></ul>
<p>
<ul>
<li>Documentation [joes] Updated Cookie_pod to reflect API changes over v1.X.</li></ul>
<p>
<ul>
<li>Documentation [joes] Added doxygen links to Apache::Request and Apache::Cookie perl docs.</li></ul>
<p>
<ul>
<li>C API [joes] Added apreq_copy_brigade(bb) to <a class="el" href="apreq_8h.html">apreq.h</a>.</li></ul>
<p>
<ul>
<li>C API [joes] The new filter-based design required a complete departure from libapreq-1.X codebase. libapreq-2 is based solely on APR, and to be fully functional, requires a supporting environment similar to Apache-2. A person wishing to port libapreq-2 to a new environment needs to provide definitions for the declarations in apreq_env.h.</li></ul>
<p>
<ul>
<li>Perl API [joes] Aggregates are always collected into an APR::Table-based package. New table packages: Apache::Cookie::Table, Apache::Request::Table, and Apache::Upload::Table.</li></ul>
<p>
<ul>
<li>Perl API [joes] Apache::Cookie-&gt;fetch now requires an "environment" argument ($r). Its return value is blessed into the Apache::Cookie::Jar class.</li></ul>
<p>
<ul>
<li>Perl API [joes] Two new request lookup functions:<ol type=a>
<li>$req-&gt;args - param lookup using only the query string</li><li>$req-&gt;body - param lookup using only the POST data </li></ol>
</li></ul>
<div id="footer">
<p class="apache">
Copyright &copy; 2003-2005 <a href="http://www.apache.org">The Apache Software Foundation</a>.<br/>
See <a href="apreq_license.html">LICENSE</a>.</p>
<p class="menu">
<span style="color:#aaa">page generated by <a href="http://www.doxygen.org/"><code>doxygen</code></a>
version 1.4.2 on 4 May 2005</span>
</p>
</div>
</body>
</html>
